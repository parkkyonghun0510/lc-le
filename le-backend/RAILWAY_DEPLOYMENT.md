# Railway Deployment Guide for LC Workflow Backend

## ðŸš€ Railway Deployment Status

Your backend is **READY FOR RAILWAY DEPLOYMENT** with all necessary configurations in place.

## âœ… Pre-Deployment Checklist

### Files Ready for Railway:
- âœ… `railway.toml` - Railway configuration with auto-migrations
- âœ… `Procfile` - Alternative deployment configuration
- âœ… `requirements.txt` - Python dependencies
- âœ… `Dockerfile` - Container configuration
- âœ… `.env` - Environment template (DO NOT push to git)
- âœ… `alembic.ini` - Database migration configuration
- âœ… Migration files - Database schema updates
- âœ… Health check endpoint - `/api/v1/health`

### Code Improvements Made:
- âœ… PORT environment variable support for Railway
- âœ… Auto-migration on deployment
- âœ… Enhanced security configuration
- âœ… Comprehensive error handling
- âœ… Performance optimizations

## ðŸ”§ Railway Deployment Steps

### 1. Prepare Your Repository

```bash
# Initialize git if not already done
git init
git add .
git commit -m "Initial Railway deployment setup"

# Push to GitHub (create repo first)
git remote add origin https://github.com/yourusername/lc-workflow-backend.git
git branch -M main
git push -u origin main
```

### 2. Create Railway Project

1. Go to [Railway.app](https://railway.app)
2. Click "New Project"
3. Select "Deploy from GitHub repo"
4. Choose your repository
5. Railway will automatically detect the configuration

### 3. Add Required Services

#### PostgreSQL Database
1. In Railway dashboard, click "New Service"
2. Select "PostgreSQL"
3. Railway will create a database with connection string

#### MinIO (File Storage) - Optional but Recommended
1. Click "New Service" â†’ "Docker Image"
2. Use image: `minio/minio:latest`
3. Add environment variables:
   - `MINIO_ROOT_USER`: `admin`
   - `MINIO_ROOT_PASSWORD`: `generate_strong_password`
4. Add start command: `server /data --console-address ":9001"`

### 4. Configure Environment Variables

Add these to your Railway service Variables:

```env
# Database (Auto-generated by Railway PostgreSQL)
DATABASE_URL=postgresql+asyncpg://postgres:password@host:port/railway

# Security (IMPORTANT: Generate new values)
SECRET_KEY=your-super-secure-secret-key-here-make-it-very-long
ALGORITHM=HS256
ACCESS_TOKEN_EXPIRE_MINUTES=30
REFRESH_TOKEN_EXPIRE_DAYS=7

# CORS (Update with your frontend URL)
CORS_ORIGINS=https://your-frontend-app.railway.app,https://yourdomain.com

# File Storage (if using Railway MinIO)
MINIO_ENDPOINT=your-minio-service.railway.app
MINIO_ACCESS_KEY=admin
MINIO_SECRET_KEY=your-minio-password
MINIO_BUCKET_NAME=lc-workflow-files
MINIO_SECURE=true

# Server Configuration
HOST=0.0.0.0
DEBUG=false

# Security Settings
RATE_LIMIT_ENABLED=true
RATE_LIMIT_REQUESTS=100
RATE_LIMIT_WINDOW=60
MIN_PASSWORD_LENGTH=8
REQUIRE_PASSWORD_SPECIAL_CHARS=true
REQUIRE_PASSWORD_NUMBERS=true
REQUIRE_PASSWORD_UPPERCASE=true
SESSION_COOKIE_SECURE=true
SESSION_COOKIE_HTTPONLY=true
SESSION_COOKIE_SAMESITE=lax
```

### 5. Deploy and Monitor

1. Railway will automatically deploy when you push to main branch
2. Monitor the build logs in Railway dashboard
3. Check the deployment URL once ready
4. Verify health check: `https://your-app.railway.app/api/v1/health`

## ðŸ”’ Security Considerations for Production

### Before Going Live:

1. **Generate Secure Secret Key:**
   ```python
   import secrets
   secret_key = secrets.token_urlsafe(32)
   print(f"SECRET_KEY={secret_key}")
   ```

2. **Update CORS Origins:**
   - Add your actual frontend domain(s)
   - Remove localhost URLs

3. **Enable Security Features:**
   - Set `DEBUG=false`
   - Enable all password requirements
   - Configure rate limiting

4. **Database Security:**
   - Railway PostgreSQL is automatically secured
   - Use connection pooling for production
   - Enable SSL connections

## ðŸš€ Deployment Commands

Railway will automatically run these during deployment:

```bash
# Install dependencies
pip install -r requirements.txt

# Run database migrations
alembic upgrade head

# Start the application
uvicorn app.main:app --host=0.0.0.0 --port=$PORT
```

## ðŸ“Š Post-Deployment Verification

### Test These Endpoints:

1. **Health Check:**
   ```bash
   curl https://your-app.railway.app/api/v1/health
   ```

2. **API Documentation:**
   ```
   https://your-app.railway.app/docs
   ```

3. **Root Endpoint:**
   ```bash
   curl https://your-app.railway.app/
   ```

### Expected Responses:

- Health check should return `{"status": "healthy", "database": "connected"}`
- API docs should load the Swagger UI
- Root should return `{"message": "LC Work Flow API is running"}`

## ðŸ”§ Troubleshooting

### Common Issues:

1. **Database Connection Failed:**
   - Check DATABASE_URL environment variable
   - Ensure PostgreSQL service is running
   - Verify connection string format

2. **Port Binding Error:**
   - Railway automatically provides PORT env var
   - Don't hardcode port in production

3. **Migration Errors:**
   - Check if database is accessible
   - Verify alembic configuration
   - Check migration file syntax

4. **File Upload Issues:**
   - Verify MinIO configuration
   - Check CORS settings for file upload endpoints
   - Ensure proper authentication headers

### Debug Commands:

```bash
# Check Railway logs
railway logs

# Connect to Railway database
railway run psql $DATABASE_URL

# Run migrations manually
railway run alembic upgrade head
```

## ðŸŽ¯ Performance Optimization

### For Production Traffic:

1. **Database Optimization:**
   - All performance indexes already added
   - Connection pooling configured
   - Query optimization in place

2. **Caching Strategy:**
   - Redis/DragonflyDB for session caching
   - File URL caching for MinIO

3. **Monitoring:**
   - Railway provides built-in monitoring
   - Set up alerts for health check failures
   - Monitor database connection pool

## ðŸ”„ CI/CD Pipeline

Railway automatically:
- âœ… Builds on every push to main
- âœ… Runs database migrations
- âœ… Performs health checks
- âœ… Rolls back on failure
- âœ… Provides deployment logs

## ðŸŽ‰ Next Steps After Deployment

1. **Test all API endpoints with Postman or similar**
2. **Set up monitoring and alerting**
3. **Configure custom domain (optional)**
4. **Set up staging environment**
5. **Configure backup strategies**
6. **Update frontend to use Railway API URL**

---

## ðŸ“ž Support

If you encounter issues:
1. Check Railway logs first
2. Verify environment variables
3. Test database connectivity
4. Check the health endpoint
5. Review the troubleshooting section above

**Your LC Workflow Backend is now ready for Railway deployment! ðŸš€**